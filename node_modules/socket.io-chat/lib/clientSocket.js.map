{"version":3,"sources":["../src/clientSocket.es6"],"names":[],"mappings":"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","file":"src/clientSocket.es6","sourcesContent":["(function () {\n\t\"use strict\";\n\n\tvar ClientError = require('./error'),\n\t\tdebug = require('debug')('develop');\n\n\tfunction catchErrorMessage(error) {\n\t\tswitch (error.type) {\n\t\t\tcase 'validation':\n\t\t\tcase 'client':\n\t\t\t\treturn error.message;\n\t\t\tdefault:\n\t\t\t\t// TODO: debug(error.stack);\n\t\t\t\tdebug(error.stack);\n\t\t\t\treturn 'Unknown error';\n\t\t}\n\t}\n\n\t/**\n\t * @function socketError\n\t * @param {String} event\n\t * @param {Error|String} error\n\t * @returns {Error}\n\t */\n\tfunction socketError(event, error) {\n\t\tvar sError = new Error();\n\n\t\tsError.event = String(event);\n\n\t\tswitch (Object.prototype.toString.call(error)) {\n\t\t\tcase '[object Error]':\n\t\t\t\tsError.message = error.message;\n\t\t\t\tbreak;\n\t\t\tcase '[object String]':\n\t\t\t\tsError.message = error;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tsError.message = String(error);\n\t\t}\n\n\t\treturn sError;\n\t}\n\n\tclass ClientSocket {\n\t\tconstructor() {\n\t\t\tthis.emitResult.transform = function (data, next) {\n\t\t\t\tnext(data);\n\t\t\t};\n\n\t\t\tthis.emitError.transform = function (data, next) {\n\t\t\t\tnext(data);\n\t\t\t};\n\n\t\t\tthis.emitError.transformOn = (event, cb) => {\n\t\t\t\tif (!this.emitError.__transforms) {\n\t\t\t\t\tthis.emitError.__transforms = {}\n\t\t\t\t}\n\n\t\t\t\tif (!this.emitError.__transforms[event]) {\n\t\t\t\t\tthis.emitError.__transforms[event] = [];\n\t\t\t\t}\n\n\t\t\t\tthis.emitError.__transforms[event].push(cb);\n\n\t\t\t\treturn this.emitResult;\n\t\t\t};\n\n\t\t\tthis.emitResult.transformOn = (event, cb) => {\n\t\t\t\tif (!this.emitResult.__transforms) {\n\t\t\t\t\tthis.emitResult.__transforms = {}\n\t\t\t\t}\n\n\t\t\t\tif (!this.emitResult.__transforms[event]) {\n\t\t\t\t\tthis.emitResult.__transforms[event] = [];\n\t\t\t\t}\n\n\t\t\t\tthis.emitResult.__transforms[event].push(cb);\n\n\t\t\t\treturn this.emitResult;\n\t\t\t};\n\t\t}\n\n\t\temitError(socket, event, data) {\n\t\t\tvar index      = 0,\n\t\t\t\ttransforms = this.emitError.__transforms || {},\n\t\t\t\ttransformCb;\n\n\t\t\tfunction nextTransform(data) {\n\t\t\t\ttransformCb = transforms[event] ? transforms[event][index] : null;\n\n\t\t\t\tif (transformCb) {\n\t\t\t\t\ttransformCb(data, function (data) {\n\t\t\t\t\t\tindex++;\n\n\t\t\t\t\t\tif (transforms.length === index) {\n\t\t\t\t\t\t\tsocket.emit(event, { error: data });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnextTransform(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsocket.emit(event, { error: data });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.emitError.transform(data, (data) => {\n\t\t\t\tnextTransform(data);\n\t\t\t});\n\t\t}\n\n\t\temitResult(socket, event, data) {\n\t\t\tvar index      = 0,\n\t\t\t\ttransforms = this.emitResult.__transforms || {},\n\t\t\t\ttransformCb;\n\n\t\t\tfunction nextTransform(data) {\n\t\t\t\ttransformCb = transforms[event] ? transforms[event][index] : null;\n\n\t\t\t\tif (transformCb) {\n\t\t\t\t\ttransformCb(data, function (data) {\n\t\t\t\t\t\tindex++;\n\n\t\t\t\t\t\tif (transforms.length === index) {\n\t\t\t\t\t\t\tsocket.emit(event, { result: data });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnextTransform(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsocket.emit(event, { result: data });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.emitResult.transform(data, (data) => {\n\t\t\t\tnextTransform(data);\n\t\t\t});\n\t\t}\n\n\t\tonAuthenticate(client, socket, data = {}) {\n\t\t\tclient.emit(client.EVENTS.AUTHENTICATE, socket, data, (error) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn this.emitError(socket, 'login', { message: error.message || error });\n\t\t\t\t}\n\n\t\t\t\tif (!client.authorize(socket)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tclient.__members.add(socket.user, socket);\n\n\t\t\t\tthis.emitResult(socket, 'login', { user: socket.user });\n\t\t\t\tthis.emitResult(socket, 'authenticate', { user: socket.user });\n\t\t\t});\n\t\t}\n\n\t\tonCreate(client, socket, data = {}) {\n\t\t\tclient.create(data, socket.user)\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tthis.emitResult(socket, client.EVENTS.CREATE, { message: 'Chat created', data: chat.toJSON() });\n\n\t\t\t\t\tclient.__rooms.addMembers(\n\t\t\t\t\t\tchat.get('_id'),\n\t\t\t\t\t\tclient.__members.get(chat.get('members'))\n\t\t\t\t\t);\n\n\t\t\t\t\tclient.__members.get(chat.get('members'))\n\t\t\t\t\t\t.forEach((socket) => {\n\t\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.JOIN, {\n\t\t\t\t\t\t\t\tmessage: 'Join to chat',\n\t\t\t\t\t\t\t\tdata:    chat.toJSON()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treturn this.emitError(socket, client.EVENTS.CREATE, { message: error.message });\n\t\t\t\t});\n\t\t}\n\n\t\tonLeave(client, socket, data = {}) {\n\t\t\tvar chat;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn client.leave(chat, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((member) => {\n\t\t\t\t\tclient.__rooms.removeMember(chat.get('_id'), member);\n\n\t\t\t\t\tlet receivers = chat.get('members').concat(member),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.leaveMember) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, { whoLeaved: member })\n\t\t\t\t\t\t\t.then((message) => {\n\t\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWSYSTEMMESSAGE, {\n\t\t\t\t\t\t\t\t\t\tmessage: 'New system message', data: message.toJSON(), chatId: chat.get('_id')\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.LEAVE, {\n\t\t\t\t\t\t\tmessage: 'The member leaved',\n\t\t\t\t\t\t\tdata:    member,\n\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.LEAVE, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonAddMember(client, socket, data = {}) {\n\t\t\tvar chat, countBefore, countAfter;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\tcountBefore = chat.get('members').length;\n\n\t\t\t\t\treturn client.addMember(chat, data.member, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((member) => {\n\t\t\t\t\tcountAfter = chat.get('members').length;\n\n\t\t\t\t\tif (countBefore === countAfter) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet receivers = chat.get('members'),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tclient.__rooms.addMembers(chat.get('_id'), member);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.addMember) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, { whoAdded: socket.user, whomAdded: member })\n\t\t\t\t\t\t\t.then((message) => {\n\t\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\t\t\t\tdata:    message.toJSON(),\n\t\t\t\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.ADDMEMBER, {\n\t\t\t\t\t\t\tmessage: 'The member added',\n\t\t\t\t\t\t\tdata:    member,\n\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.ADDMEMBER, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonRemoveMember(client, socket, data = {}) {\n\t\t\tvar chat, countBefore, countAfter;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\tcountBefore = chat.get('members').length;\n\n\t\t\t\t\treturn client.removeMember(chat, data.member, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((member) => {\n\t\t\t\t\tcountAfter = chat.get('members').length;\n\n\t\t\t\t\tif (countBefore === countAfter) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tclient.__rooms.removeMember(chat.get('_id'), member);\n\n\t\t\t\t\tlet receivers = chat.get('members').concat(member),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.removeMember) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, { whoRemove: socket.user, whomRemove: member })\n\t\t\t\t\t\t\t.then((message) => {\n\t\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\t\t\t\tdata:    message.toJSON(),\n\t\t\t\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.REMOVEMEMBER, {\n\t\t\t\t\t\t\tmessage: 'The member removed',\n\t\t\t\t\t\t\tdata:    member,\n\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.REMOVEMEMBER, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonNewMessage(client, socket, data = {}) {\n\t\t\tvar chat;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn client.newMessage(chat, data, socket.user);\n\t\t\t\t})\n\t\t\t\t.then((message) => {\n\t\t\t\t\tclient.__members.get(chat.get('members'))\n\t\t\t\t\t\t.forEach((socket) => {\n\t\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\tmessage: 'New message',\n\t\t\t\t\t\t\t\tdata:    message.toJSON(),\n\t\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.NEWMESSAGE, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonFindMessagesLast(client, socket, data = {}) {\n\t\t\tclient.findLastMessages(data.chatId, socket.user, data.limit, FLAGS.RECEIVER, {\n\t\t\t\tfilter: data.filter, sort: data.sort, limit: data.limit, next: data.next, prev: data.prev\n\t\t\t})\n\t\t\t\t.then((messages) => {\n\t\t\t\t\tthis.emitResult(socket, client.EVENTS.FINDMESSAGESLAST, {\n\t\t\t\t\t\tchatId: data.chatId,\n\t\t\t\t\t\tdata:   messages\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.FINDMESSAGESLAST, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonFindMessagesFrom(client, socket, data = {}) {\n\t\t\tclient.findFromMessages(data.chatId, data.messageId, socket.user, data.limit, FLAGS.RECEIVER, {\n\t\t\t\tfilter: data.filter, sort: data.sort, limit: data.limit, next: data.next, prev: data.prev\n\t\t\t})\n\t\t\t\t.then((messages) => {\n\t\t\t\t\tthis.emitResult(socket, client.EVENTS.FINDMESSAGESFROM, {\n\t\t\t\t\t\tchatId: data.chatId,\n\t\t\t\t\t\tdata:   messages\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.FINDMESSAGESFROM, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonFindMessagesAt(client, socket, data = {}) {\n\t\t\tclient.findAtMessages(data.chatId, data.messageId, socket.user, data.limit, FLAGS.RECEIVER, {\n\t\t\t\tfilter: data.filter, sort: data.sort, limit: data.limit, next: data.next, prev: data.prev\n\t\t\t})\n\t\t\t\t.then((messages) => {\n\t\t\t\t\tthis.emitResult(socket, client.EVENTS.FINDMESSAGESAT, { chatId: data.chatId, data: messages });\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.FINDMESSAGESAT, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonFindChat(client, socket, data = {}) {\n\t\t\tclient.findChatById(socket.user, data.chatId)\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tthis.emitResult(socket, client.EVENTS.FINDCHAT, { data: chat });\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.FINDCHAT, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonFindChats(client, socket, data = {}) {\n\t\t\tclient.findChats(socket.user, data.limit, {\n\t\t\t\tfilter: data.filter, sort: data.sort, limit: data.limit, next: data.next, prev: data.prev\n\t\t\t})\n\t\t\t\t.then((chats) => {\n\t\t\t\t\tthis.emitResult(socket, client.EVENTS.FINDCHATS, { data: chats });\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.FINDCHATS, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonChangeTitle(client, socket, data = {}) {\n\t\t\tvar oldTitle;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tif (!chat) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\toldTitle = String(chat.get('title'));\n\n\t\t\t\t\treturn client.changeTitle(chat, data.title, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tlet receivers = chat.get('members'),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.changeTitle) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, {\n\t\t\t\t\t\t\tchanged: socket.user, oldTitle: oldTitle, newTitle: chat.get('title')\n\t\t\t\t\t\t}).then((message) => {\n\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\t\t\tdata:    message.toJSON(),\n\t\t\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.CHANGETITLE, {\n\t\t\t\t\t\t\tmessage: 'Title changed',\n\t\t\t\t\t\t\tdata:    chat.get('title'),\n\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.emitError(socket, client.EVENTS.CHANGETITLE, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tgetByUser() {\n\n\t\t}\n\n\t\tgetAll() {\n\n\t\t}\n\t}\n\n\tmodule.exports = ClientSocket;\n}());"]}