{"version":3,"sources":["../../src/client/action.es6"],"names":[],"mappings":";;;;;;;;;;;;0BAAc,YAAY;;;;qBACR,UAAU;;;;qBACJ,UAAU;;;;IAE5B,YAAY;AACN,UADN,YAAY,GACH;wBADT,YAAY;;AAEhB,MAAI,CAAC,YAAY,GAAG,EAAE,CAAC;;AAEvB,MAAI,CAAC,YAAY,CAAC,mBAAM,MAAM,EAAE,YAAwB;OAAd,OAAO,yDAAG,EAAE;;AACrD,UAAO,OAAO,CAAC,IAAI,CAAC,SAAS,IAAI,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;GAClF,EAAE,sBAAsB,CAAC,CAAC;;AAE3B,MAAI,CAAC,YAAY,CAAC,mBAAM,MAAM,EAAE,YAAwB;OAAd,OAAO,yDAAG,EAAE;;AACrD,UAAO,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;GACjD,EAAE,sBAAsB,CAAC,CAAC;;AAE3B,MAAI,CAAC,YAAY,CAAC,mBAAM,KAAK,EAAE,YAAwB;OAAd,OAAO,yDAAG,EAAE;;AACpD,UAAO,IAAI,CAAC;GACZ,CAAC,CAAC;EACH;;cAfI,YAAY;;SAiBL,sBAAC,IAAI,EAAE,SAAS,EAAgB;OAAd,OAAO,yDAAG,EAAE;;AACzC,OAAI,CAAC,IAAI,EAAE,OAAO,KAAK,CAAC;AACxB,OAAI,CAAC,SAAS,EAAE,OAAO,KAAK,CAAC;AAC7B,OAAI,EAAE,SAAS,YAAY,QAAQ,CAAA,AAAC,EAAE,OAAO,KAAK,CAAC;AACnD,OAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,OAAO,KAAK,CAAC;;AAE1C,OAAI,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG;AACzB,MAAE,EAAO,SAAS;AAClB,WAAO,EAAE,OAAO;IAChB,CAAC;;AAEF,UAAO,IAAI,CAAC;GACZ;;;SAEc,yBAAC,IAAI,EAAE;AACrB,UAAO,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;GACtC;;;SAEO,kBAAC,IAAI,EAAgB;;;OAAd,OAAO,yDAAG,EAAE;;AAC1B,OAAI,MAAM,GAAG,KAAK;OAAE,KAAK,CAAC;;AAE1B,UAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACvC,QAAI,MAAM,GAAG,KAAK;QAAE,OAAO,GAAG,cAAc,CAAC;;AAE7C,QAAI,MAAK,YAAY,CAAC,IAAI,CAAC,IAAI,MAAK,YAAY,CAAC,IAAI,CAAC,CAAC,EAAE,YAAY,QAAQ,EAAE;AAC9E,WAAM,GAAI,MAAK,YAAY,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC;AAC9C,YAAO,GAAG,MAAK,YAAY,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC;KAC1C;;AAED,WAAO,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC,uBAAgB,OAAO,CAAC,CAAC,CAAC;IACpE,CAAC,CAAC;GACH;;;QAhDI,YAAY;;;qBAmDH,YAAY","file":"action.js","sourcesContent":["import _ from 'underscore';\nimport FLAGS from '../flags';\nimport ClientError from '../error';\n\nclass ClientAction {\n\tconstructor() {\n\t\tthis.__validators = {};\n\n\t\tthis.addValidator(FLAGS.AUTHOR, function (options = {}) {\n\t\t\treturn options.chat.creatorId && options.chat.creatorId.equals(options.performer);\n\t\t}, 'Performer not author');\n\n\t\tthis.addValidator(FLAGS.MEMBER, function (options = {}) {\n\t\t\treturn options.chat.hasMember(options.performer);\n\t\t}, 'Performer not member');\n\n\t\tthis.addValidator(FLAGS.OTHER, function (options = {}) {\n\t\t\treturn true;\n\t\t});\n\t}\n\n\taddValidator(flag, validator, message = '') {\n\t\tif (!flag) return false;\n\t\tif (!validator) return false;\n\t\tif (!(validator instanceof Function)) return false;\n\t\tif (this.__validators[flag]) return false;\n\n\t\tthis.__validators[flag] = {\n\t\t\tcb:      validator,\n\t\t\tmessage: message\n\t\t};\n\n\t\treturn true;\n\t}\n\n\tremoveValidator(flag) {\n\t\treturn delete this.__validators[flag];\n\t}\n\n\tvalidate(flag, options = {}) {\n\t\tvar result = false, error;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tvar result = false, message = 'Unknown flag';\n\n\t\t\tif (this.__validators[flag] && this.__validators[flag].cb instanceof Function) {\n\t\t\t\tresult  = this.__validators[flag].cb(options);\n\t\t\t\tmessage = this.__validators[flag].message;\n\t\t\t}\n\n\t\t\treturn result ? resolve(options) : reject(new ClientError(message));\n\t\t});\n\t}\n}\n\nexport default ClientAction;"]}