{"version":3,"sources":["../src/clientResponse.es6"],"names":[],"mappings":"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","file":"src/clientResponse.es6","sourcesContent":["\nclass ClientResponse {\n\tconstructor (client) {\n\t\tthis.client = client;\n\n\t\tthis.emitResult.transform = function (data, next) {\n\t\t\tnext(data);\n\t\t};\n\n\t\tthis.emitError.transform = function (data, next) {\n\t\t\tnext(data);\n\t\t};\n\n\t\tthis.emitError.transformOn = (event, cb) => {\n\t\t\tif (!this.emitError.__transforms) {\n\t\t\t\tthis.emitError.__transforms = {}\n\t\t\t}\n\n\t\t\tif (!this.emitError.__transforms[event]) {\n\t\t\t\tthis.emitError.__transforms[event] = [];\n\t\t\t}\n\n\t\t\tthis.emitError.__transforms[event].push(cb);\n\n\t\t\treturn this.emitResult;\n\t\t};\n\n\t\tthis.emitResult.transformOn = (event, cb) => {\n\t\t\tif (!this.emitResult.__transforms) {\n\t\t\t\tthis.emitResult.__transforms = {}\n\t\t\t}\n\n\t\t\tif (!this.emitResult.__transforms[event]) {\n\t\t\t\tthis.emitResult.__transforms[event] = [];\n\t\t\t}\n\n\t\t\tthis.emitResult.__transforms[event].push(cb);\n\n\t\t\treturn this.emitResult;\n\t\t};\n\t}\n\n\temitError(socket, event, data) {\n\t\tvar index      = 0,\n\t\t\ttransforms = this.emitError.__transforms || {},\n\t\t\ttransformCb;\n\n\t\tfunction nextTransform(data) {\n\t\t\ttransformCb = transforms[event] ? transforms[event][index] : null;\n\n\t\t\tif (transformCb) {\n\t\t\t\ttransformCb(data, function (data) {\n\t\t\t\t\tindex++;\n\n\t\t\t\t\tif (transforms.length === index) {\n\t\t\t\t\t\tsocket.emit(event, { error: data });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextTransform(data);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsocket.emit(event, { error: data });\n\t\t\t}\n\t\t}\n\n\t\tthis.emitError.transform(data, (data) => {\n\t\t\tnextTransform(data);\n\t\t});\n\t}\n\n\temitResult(socket, event, data) {\n\t\tvar index      = 0,\n\t\t\ttransforms = this.emitResult.__transforms || {},\n\t\t\ttransformCb;\n\n\t\tfunction nextTransform(data) {\n\t\t\ttransformCb = transforms[event] ? transforms[event][index] : null;\n\n\t\t\tif (transformCb) {\n\t\t\t\ttransformCb(data, function (data) {\n\t\t\t\t\tindex++;\n\n\t\t\t\t\tif (transforms.length === index) {\n\t\t\t\t\t\tsocket.emit(event, { result: data });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextTransform(data);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsocket.emit(event, { result: data });\n\t\t\t}\n\t\t}\n\n\t\tthis.emitResult.transform(data, (data) => {\n\t\t\tnextTransform(data);\n\t\t});\n\t}\n\n\t// authenticate () {\n\t// \tclient.__members.add(socket.user, socket);\n\n\t// \tthis.emitResult(socket, 'login', { user: socket.user });\n\t// \tthis.emitResult(socket, 'authenticate', { user: socket.user });\n\t// }\n\n\tcreate(chat) {\n\t\tlet client = this;\n\t\t\n\t\tthis.emitResult(socket, client.EVENTS.CREATE, { message: 'Chat created', data: chat.toJSON() });\n\n\t\tclient.__rooms.addMembers(\n\t\t\tchat.get('_id'),\n\t\t\tclient.__members.get(chat.get('members'))\n\t\t);\n\n\t\tclient.__members.get(chat.get('members'))\n\t\t\t.forEach((socket) => {\n\t\t\t\tthis.emitResult(socket, client.EVENTS.JOIN, {\n\t\t\t\t\tmessage: 'Join to chat',\n\t\t\t\t\tdata:    chat.toJSON()\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tleave() {\n\t\tlet client = this;\n\n\t\tclient.__rooms.removeMember(chat.get('_id'), member);\n\n\t\tlet receivers = chat.get('members').concat(member),\n\t\t\tsockets   = client.__members.get(receivers);\n\n\t\tif (chat.systemMessages && chat.systemMessages.leaveMember) {\n\t\t\tclient.newSystemMessage(chat, { whoLeaved: member })\n\t\t\t\t.then((message) => {\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWSYSTEMMESSAGE, {\n\t\t\t\t\t\t\tmessage: 'New system message', data: message.toJSON(), chatId: chat.get('_id')\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t}\n\n\t\tsockets.forEach((socket) => {\n\t\t\tthis.emitResult(socket, client.EVENTS.LEAVE, {\n\t\t\t\tmessage: 'The member leaved',\n\t\t\t\tdata:    member,\n\t\t\t\tchatId:  chat.get('_id')\n\t\t\t});\n\t\t});\n\t}\n\taddMember() {}\n\tfindMessagesLast() {}\n\tfindMessagesFrom() {}\n\tfindMessagesAt() {}\n\tfindChat() {}\n\tfindChats() {}\n\tchangeTitle() {}\n\n\tremoveMember (member, chat) {\n\t\tlet client = this;\n\n\t\tclient.__rooms.removeMember(chat.get('_id'), member);\n\n\t\tlet receivers = chat.get('members').concat(member),\n\t\t\tsockets   = client.__members.get(receivers);\n\n\t\tif (chat.systemMessages && chat.systemMessages.removeMember) {\n\t\t\tclient.newSystemMessage(chat, { whoRemove: socket.user, whomRemove: member })\n\t\t\t\t.then((message) => {\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\tdata:    message.toJSON(),\n\t\t\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t}\n\n\t\tsockets.forEach((socket) => {\n\t\t\tthis.emitResult(socket, client.EVENTS.REMOVEMEMBER, {\n\t\t\t\tmessage: 'The member removed',\n\t\t\t\tdata:    member,\n\t\t\t\tchatId:  chat.get('_id')\n\t\t\t});\n\t\t});\n\t}\n\n\tnewMessage (message, chat) {\n\t\tlet client = this;\n\n\t\tclient.__members.get(chat.get('members'))\n\t\t\t.forEach((socket) => {\n\t\t\t\tthis.emitResult(socket, client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\tmessage: 'New message',\n\t\t\t\t\tdata:    message.toJSON(),\n\t\t\t\t\tchatId:  chat.get('_id')\n\t\t\t\t});\n\t\t\t});\n\t}\n}\n\nexport default new ClientResponse();"]}